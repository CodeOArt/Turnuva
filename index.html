<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YeÅŸilTepe Futbol TurnuvasÄ±</title>
  <style>
    body {
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      color: white;
      font-family: 'Montserrat', sans-serif;
      padding: 20px;
    }
    h1, h2, h3 {
      text-align: center;
      color: #1de9b6;
    }
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #1f1f1f;
      border-radius: 16px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    th, td {
      padding: 14px;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    th {
      background: #1de9b6;
      color: black;
      font-weight: bold;
    }
    tr:last-child td {
      border-bottom: none;
    }
    tr:hover {
      background-color: #2c3e50;
    }
    .admin-panel, .keypad, .match-box {
      background: #1f1f1f;
      padding: 20px;
      max-width: 600px;
      margin: 20px auto;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      outline: none;
      box-sizing: border-box;
    }
    input, select {
      background: #333;
      color: white;
    }
    button {
      background: #1de9b6;
      color: black;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      transition: background 0.3s;
    }
    button:hover {
      background: #ff9100;
      color: black;
    }
    .keypad-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .hidden {
      display: none !important;
    }
    .match-tag {
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 12px;
    }
    .tag-league {
      background-color: rgba(29, 233, 182, 0.2);
      color: #1de9b6;
      border: 1px solid #1de9b6;
    }
    .tag-friendly {
      background-color: rgba(158, 158, 158, 0.2);
      color: #9e9e9e;
      border: 1px solid #9e9e9e;
    }
    /* Bildirim butonu saÄŸ Ã¼stte */
   #notifyBtn {
  position: fixed;
  top: 22;
  right: 15px;
  background-color: #1de9b6;
  color: black;
  font-weight: bold;
  border: none;
  padding: 8px 12px;
  border-radius: 25%;
  cursor: pointer;
  z-index: 9999;
  font-size: 13px;
  width: 110px;
  height: 45px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  transition: background-color 0.3s ease;
}

#notifyBtn:hover {
  background-color: #00b386;
}

    /* Animasyonlu popup bildirim */
    #popupNotification {
      position: fixed;
      top: 20px;
      right: -400px;
      background: #1de9b6;
      color: black;
      font-weight: bold;
      padding: 15px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
      transition: right 0.5s ease-in-out, opacity 0.5s;
      z-index: 9999;
      font-family: 'Montserrat', sans-serif;
      opacity: 0;
    }
  </style>
</head>
<body>

  <button id="notifyBtn">ðŸ”” Bildirimleri AÃ§</button>

  <div id="popupNotification">
    <span id="popupTitle">BaÅŸlÄ±k</span><br>
    <span id="popupBody" style="font-weight: normal;">Mesaj iÃ§eriÄŸi</span>
  </div>

  <h1>YeÅŸilTepe Futbol TurnuvasÄ±</h1>

  <h2>TakÄ±m SÄ±ralamasÄ±</h2>
  <div class="table-container">
    <table id="rankingTable">
      <thead>
        <tr>
          <th>SÄ±ralama</th>
          <th>TakÄ±m AdÄ±</th>
          <th>Galibiyet</th>
          <th>MaÄŸlubiyet</th>
          <th>Puan</th>
        </tr>
      </thead>
      <tbody id="rankingBody"></tbody>
    </table>
  </div>

  <h2>YaklaÅŸan MaÃ§</h2>
  <div class="match-box" id="upcomingMatchBox">
    <div style="font-size:18px; color:#ff9100; text-align:center;" id="upcomingMatchText">HenÃ¼z belirlenmedi</div>
    <div style="font-size:14px; color:#ff9100; text-align:center;" id="upcomingMatchTime">Tarih: - | Saat: -</div>
  </div>

  <h2>GeÃ§miÅŸ MaÃ§lar</h2>
  <div class="match-box">
    <table id="pastMatchesTable">
      <thead>
        <tr><th>TakÄ±m 1</th><th>Skor</th><th>TakÄ±m 2</th><th>TÃ¼r</th></tr>
      </thead>
      <tbody id="pastMatches"></tbody>
    </table>
  </div>

  <button id="openAdminBtn" style="display:block; margin:20px auto; max-width:600px; background:#ff9100; color:#000; font-weight:bold; border:none; border-radius:8px; padding:12px; cursor:pointer;">
    Admin Panelini AÃ§ / Kapat
  </button>

  <div class="keypad hidden" id="keypadPanel">
    <h3>Admin Panel GiriÅŸi</h3>
    <input type="password" id="pinDisplay" placeholder="Åžifre" readonly />
    <div class="keypad-buttons" id="keypadButtons">
      <button type="button" data-key="1">1</button>
      <button type="button" data-key="2">2</button>
      <button type="button" data-key="3">3</button>
      <button type="button" data-key="4">4</button>
      <button type="button" data-key="5">5</button>
      <button type="button" data-key="6">6</button>
      <button type="button" data-key="7">7</button>
      <button type="button" data-key="8">8</button>
      <button type="button" data-key="9">9</button>
      <button type="button" id="clearPinBtn">Temizle</button>
      <button type="button" data-key="0">0</button>
      <button type="button" id="enterPinBtn">GiriÅŸ</button>
    </div>
  </div>

  <div class="admin-panel hidden" id="adminPanel">

    <h3>TakÄ±m Ekle</h3>
    <input type="text" id="teamName" placeholder="TakÄ±m AdÄ±" />
    <button id="addTeamBtn">TakÄ±mÄ± Ekle</button>

    <h3>Yeni MaÃ§ Belirle</h3>
    <div style="display:flex; gap:10px; margin-bottom:10px;">
      <select id="teamA" style="flex:1"></select> vs <select id="teamB" style="flex:1"></select>
    </div>
    <input type="date" id="matchDate" />
    <input type="time" id="matchTimeInput" />
    <button id="setUpcomingMatchBtn">MaÃ§Ä± Belirle</button>

    <h3>Skor Ekle</h3>
    <select id="matchTypeSelect">
      <option value="Lig">Lig MaÃ§Ä± (PuanlÄ±)</option>
      <option value="HazÄ±rlÄ±k">HazÄ±rlÄ±k MaÃ§Ä± (PuansÄ±z)</option>
    </select>
    <div style="display:flex; gap:10px; margin-bottom:10px; align-items:center;">
      <select id="team1" style="flex:1"></select>
      <input type="number" id="score1" placeholder="Skor" min="0" style="flex:0.5;" />
      <span>-</span>
      <input type="number" id="score2" placeholder="Skor" min="0" style="flex:0.5;" />
      <select id="team2" style="flex:1"></select>
    </div>
    <button id="addPastMatchBtn">Skoru Ekle</button>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, runTransaction } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    // Firebase yapÄ±landÄ±rma
    const firebaseConfig = {
      apiKey: "AIzaSyC_4leEyiGLUg4pF420WtQOC2om-OyWoEU",
      authDomain: "futbol-1e4a5.firebaseapp.com",
      databaseURL: "https://futbol-1e4a5-default-rtdb.firebaseio.com",
      projectId: "futbol-1e4a5",
      storageBucket: "futbol-1e4a5.appspot.com",
      messagingSenderId: "915149469219",
      appId: "1:915149469219:web:dbc7fd59a2aa8708536396",
      measurementId: "G-ZF51DF32W7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // DOM referanslarÄ±
    const rankingBody = document.getElementById("rankingBody");
    const upcomingMatchText = document.getElementById("upcomingMatchText");
    const upcomingMatchTime = document.getElementById("upcomingMatchTime");
    const pastMatchesBody = document.getElementById("pastMatches");

    const keypadPanel = document.getElementById("keypadPanel");
    const adminPanel = document.getElementById("adminPanel");
    const openAdminBtn = document.getElementById("openAdminBtn");
    const pinDisplay = document.getElementById("pinDisplay");
    const clearPinBtn = document.getElementById("clearPinBtn");
    const enterPinBtn = document.getElementById("enterPinBtn");
    const keypadButtons = document.querySelectorAll("#keypadButtons button[data-key]");

    const teamNameInput = document.getElementById("teamName");
    const addTeamBtn = document.getElementById("addTeamBtn");

    const teamASelect = document.getElementById("teamA");
    const teamBSelect = document.getElementById("teamB");
    const matchDateInput = document.getElementById("matchDate");
    const matchTimeInput = document.getElementById("matchTimeInput");
    const setUpcomingMatchBtn = document.getElementById("setUpcomingMatchBtn");

    const team1Select = document.getElementById("team1");
    const team2Select = document.getElementById("team2");
    const score1Input = document.getElementById("score1");
    const score2Input = document.getElementById("score2");
    const matchTypeSelect = document.getElementById("matchTypeSelect");
    const addPastMatchBtn = document.getElementById("addPastMatchBtn");

    // Bildirim butonu
    const notifyBtn = document.getElementById("notifyBtn");
    const popup = document.getElementById("popupNotification");
    const popupTitle = document.getElementById("popupTitle");
    const popupBody = document.getElementById("popupBody");

    // Admin panel aÃ§ma/kapama & ÅŸifre yÃ¶netimi
    let pin = "";
    openAdminBtn.addEventListener("click", () => {
      if (!adminPanel.classList.contains("hidden")) {
        adminPanel.classList.add("hidden");
        keypadPanel.classList.add("hidden");
      } else {
        keypadPanel.classList.remove("hidden");
      }
      pin = "";
      pinDisplay.value = "";
    });

    keypadButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        if (pin.length < 4) {
          pin += btn.dataset.key;
          pinDisplay.value = "*".repeat(pin.length);
        }
      });
    });

    clearPinBtn.addEventListener("click", () => {
      pin = "";
      pinDisplay.value = "";
    });

    enterPinBtn.addEventListener("click", () => {
      if (pin === "1221") {
        adminPanel.classList.remove("hidden");
        keypadPanel.classList.add("hidden");
      } else {
        alert("HatalÄ± ÅŸifre!");
      }
      pin = "";
      pinDisplay.value = "";
    });

    // TakÄ±mlarÄ± Firebase'den Ã§ek ve tablo olarak gÃ¶ster
    function renderTeams(snapshot) {
      rankingBody.innerHTML = "";
      const teams = [];
      snapshot.forEach(childSnap => {
        teams.push(childSnap.val());
      });

      teams.sort((a,b) => (b.points || 0) - (a.points || 0));

      teams.forEach((team, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${i+1}</td>
          <td>${team.name}</td>
          <td>${team.wins || 0}</td>
          <td>${team.losses || 0}</td>
          <td>${team.points || 0}</td>
        `;
        rankingBody.appendChild(tr);
      });

      updateDropdowns(teams);
    }

    // DropdownlarÄ± gÃ¼ncelle
    function updateDropdowns(teams) {
      [teamASelect, teamBSelect, team1Select, team2Select].forEach(sel => {
        const currentVal = sel.value;
        sel.innerHTML = "";
        teams.forEach(team => {
          const opt = document.createElement("option");
          opt.value = team.name;
          opt.textContent = team.name;
          sel.appendChild(opt);
        });
        sel.value = currentVal;
      });
    }

    const teamsRef = ref(db, "teams");
    onValue(teamsRef, renderTeams);

    // TakÄ±m ekleme
    addTeamBtn.addEventListener("click", async () => {
      const name = teamNameInput.value.trim();
      if (!name) return alert("TakÄ±m adÄ± boÅŸ olamaz!");
      const teamRef = ref(db, "teams/" + name);
      await set(teamRef, { name, wins: 0, losses: 0, points: 0 });
      teamNameInput.value = "";
      alert(`${name} takÄ±mÄ± eklendi!`);
    });

    // YaklaÅŸan maÃ§Ä± gÃ¶ster
    function renderUpcomingMatch(snapshot) {
      const data = snapshot.val();
      if (!data || !data.teamA) {
        upcomingMatchText.textContent = "HenÃ¼z belirlenmedi";
        upcomingMatchTime.textContent = "Tarih: - | Saat: -";
        return;
      }
      upcomingMatchText.textContent = `${data.teamA} vs ${data.teamB}`;
      upcomingMatchTime.textContent = `Tarih: ${data.date} | Saat: ${data.time}`;
    }

    const upcomingMatchRef = ref(db, "upcomingMatch");
    onValue(upcomingMatchRef, renderUpcomingMatch);

    // Yeni maÃ§ belirleme
    setUpcomingMatchBtn.addEventListener("click", async () => {
      const teamA = teamASelect.value;
      const teamB = teamBSelect.value;
      const date = matchDateInput.value;
      const time = matchTimeInput.value;
      if (!teamA || !teamB || !date || !time) return alert("TÃ¼m alanlarÄ± doldurun");
      if (teamA === teamB) return alert("TakÄ±mlar farklÄ± olmalÄ±!");
      await set(upcomingMatchRef, { teamA, teamB, date, time });
      alert("YaklaÅŸan maÃ§ gÃ¼ncellendi");

      // Bildirim gÃ¶nder
      notifyAll("Turnuva Duyuru", `${teamA} vs ${teamB} maÃ§Ä± eklendi!`);

      matchDateInput.value = "";
      matchTimeInput.value = "";
    });

    // GeÃ§miÅŸ maÃ§larÄ± listele
    const pastMatchesRef = ref(db, "pastMatches");
    onValue(pastMatchesRef, snapshot => {
      pastMatchesBody.innerHTML = "";
      const matches = [];
      snapshot.forEach(childSnap => {
        matches.push(childSnap.val());
      });

      matches.reverse();

      matches.forEach(m => {
        let tagHtml = '';
        if (m.type === 'Lig') {
          tagHtml = `<span class="match-tag tag-league">LÄ°G MaÃ§Ä±</span>`;
        } else if (m.type === 'HazÄ±rlÄ±k') {
          tagHtml = `<span class="match-tag tag-friendly">HazÄ±rlÄ±k MaÃ§Ä±</span>`;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${m.team1}</td><td>${m.score1} - ${m.score2}</td><td>${m.team2}</td><td>${tagHtml}</td>`;
        pastMatchesBody.appendChild(tr);
      });
    });

    // Skor ekleme
    addPastMatchBtn.addEventListener("click", async () => {
      const team1 = team1Select.value;
      const team2 = team2Select.value;
      const score1 = parseInt(score1Input.value);
      const score2 = parseInt(score2Input.value);
      const type = matchTypeSelect.value;

      if (!team1 || !team2) return alert("TakÄ±mlarÄ± seÃ§in");
      if (team1 === team2) return alert("TakÄ±mlar farklÄ± olmalÄ±");
      if (isNaN(score1) || isNaN(score2)) return alert("GeÃ§erli skor girin");

      const newMatchRef = push(pastMatchesRef);
      await set(newMatchRef, { team1, team2, score1, score2, type });

      // Puan gÃ¼ncellemesi sadece Lig maÃ§larÄ±nda
      if (type === "Lig") {
        // TakÄ±m1 puan ve galibiyet/malubiyet
        const team1Ref = ref(db, "teams/" + team1);
        runTransaction(team1Ref, team => {
          if (team) {
            if (score1 > score2) {
              team.wins = (team.wins || 0) + 1;
              team.points = (team.points || 0) + 3;
            } else {
              team.losses = (team.losses || 0) + 1;
            }
          }
          return team;
        });

        // TakÄ±m2 puan ve galibiyet/malubiyet
        const team2Ref = ref(db, "teams/" + team2);
        runTransaction(team2Ref, team => {
          if (team) {
            if (score2 > score1) {
              team.wins = (team.wins || 0) + 1;
              team.points = (team.points || 0) + 3;
            } else {
              team.losses = (team.losses || 0) + 1;
            }
          }
          return team;
        });
      }

      alert("Skor baÅŸarÄ±yla eklendi!");

      // Bildirim gÃ¶nder
      notifyAll("Turnuva Duyuru", `${team1} ${score1} - ${score2} ${team2} skoru eklendi!`);

      // AlanlarÄ± temizle
      score1Input.value = "";
      score2Input.value = "";
    });

    // Bildirim izni isteme ve bildirim gÃ¶nderme
    function sendNotification(title, body) {
      if (!("Notification" in window)) return console.log("TarayÄ±cÄ± bildirim desteklemiyor.");
      if (Notification.permission === "granted") {
        new Notification(title, { body, icon: "https://cdn-icons-png.flaticon.com/512/5968/5968885.png" });
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            new Notification(title, { body, icon: "https://cdn-icons-png.flaticon.com/512/5968/5968885.png" });
          }
        });
      }
    }

    // Animasyonlu popup bildirim gÃ¶sterme
    function showAnimatedNotification(title, message) {
      popupTitle.textContent = title;
      popupBody.textContent = message;
      popup.style.right = "20px";
      popup.style.opacity = "1";

      setTimeout(() => {
        popup.style.right = "-400px";
        popup.style.opacity = "0";
      }, 4000);
    }

    // Bildirim ve animasyonu birlikte Ã§alÄ±ÅŸtÄ±ran fonksiyon
    function notifyAll(title, message) {
      sendNotification(title, message);
      showAnimatedNotification(title, message);
    }

    // Bildirim butonu tÄ±klama olayÄ±
    notifyBtn.addEventListener("click", () => {
      if (Notification.permission === "granted") {
        alert("Bildirim izni zaten verilmiÅŸ.");
      } else {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            alert("Bildirim izni verildi.");
          } else {
            alert("Bildirim izni reddedildi.");
          }
        });
      }
    });

  </script>
</body>
</html>
